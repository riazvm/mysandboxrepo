
{
    "description": "formatting fix",
    "status": "NONE",
    "yaml": "---\r\nruntime: \"nodejs\"\r\ncode: |\r\n    var https = require('https');\r\n    var context = require(\"./context.js\")\r\n    \r\n    //Get the entered message from task config page and assign it to message var\r\n    var message = context.getInput(\"message\");\r\n    var parentMessage = context.getInput(\"parentMessage\");\r\n    var channel = context.getInput(\"channel\");\r\n    var auth_token = context.getInput(\"authToken\");\r\n    var slackThread = context.getInput(\"slackThread\");\r\n    var colorHex = context.getInput(\"colorHex\");\r\n    var messageHeading = context.getInput(\"messageHeading\");\r\n    \r\n    var slackPayload = JSON.stringify(\r\n    {\r\n        channel: channel, // Slack user or channel, where you want to send the message\r\n        text: parentMessage,\r\n        thread_ts: slackThread,\r\n        attachments: [\r\n            {\r\n                \"fallback\": message,\r\n                \"color\": colorHex,\r\n                \"title\": messageHeading,\r\n                \"text\": message,\r\n                \"ts\": slackThread\r\n            }\r\n        ]\r\n    });\r\n\r\n    const options = {\r\n        hostname: 'slack.com',\r\n        port: 443,\r\n        path: '/api/chat.postMessage',\r\n        method: 'POST',\r\n        headers: {\r\n        'Content-Type': 'application/json; charset=utf-8',\r\n        'Content-Length': Buffer.byteLength(slackPayload),\r\n        \"Authorization\": \"Bearer \" + auth_token\r\n    }\r\n    };\r\n    \r\n    // Makes a https request and sets the output with statusCode which \r\n    // will be displayed in task result page after execution\r\n    \r\n    const req = https.request(options, (res) => {\r\n        //    context.setOutput(\"statusCode\", res.statusCode);\r\n        let data = '';\r\n\r\n        // A chunk of data has been recieved.\r\n        res.on('data', (chunk) => {\r\n            data += chunk;\r\n        });\r\n        \r\n        console.log(res.statusCode)\r\n        context.setOutput(\"statusCode\", res.statusCode);\r\n        \r\n        \r\n        res.on('end', () => {\r\n            var response = JSON.parse(data);\r\n            context.setOutput(\"slackThreadId\", response.ts)\r\n            context.setOutput(\"slackResponse\", data);\r\n        });\r\n\r\n    });\r\n\r\n    req.on('error', (e) => {\r\n    console.error(e);\r\n    });\r\n    req.write(slackPayload);\r\n    req.end();\r\ninputProperties:\r\n  - name: message\r\n    type: text\r\n    title: Message\r\n    placeHolder: Message for Slack Channel\r\n    defaultValue: Hello Slack\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: This message would be posted to the Slack channel\r\n  - name: parentMessage\r\n    type: text\r\n    title: parentMessage\r\n    placeHolder: parentMessage for Slack Channel\r\n    defaultValue: Hello Slack or null\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: This message would be posted to the Slack channel\r\n  - name: channel\r\n    type: text\r\n    title: channel\r\n    placeHolder: slack channel here\r\n    defaultValue: slack channel here\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: slack channel here\r\n  - name: authToken\r\n    type: text\r\n    title: authToken\r\n    placeHolder: Bot authToken\r\n    defaultValue: Bot authToken\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: Bot authToken\r\n  - name: slackThread\r\n    type: text\r\n    title: slackThread\r\n    placeHolder: slackThreadId\r\n    defaultValue: slackThread or null\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: slackThread for reposting to same thread can also be null\r\n  - name: messageHeading\r\n    type: text\r\n    title: messageHeading\r\n    placeHolder: messageHeading\r\n    defaultValue: slackThread or null\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: Message Heading\r\n  - name: colorHex\r\n    type: text\r\n    title: colorHex\r\n    placeHolder: colorHex\r\n    defaultValue: colorHex\r\n    bindable: true\r\n    labelInfo: true\r\n    labelMessage: Color in hex for color coding messages\r\noutputProperties:\r\n  - name: slackResponse\r\n    type: label\r\n    title: slackResponse\r\n  - name: slackThreadId\r\n    type: label\r\n    title: slackThreadId\r\n  - name: statusCode\r\n    type: label\r\n    title: Status Code",
    "version": "draft",
    "name": "SlackBotThreadedAttachments",
    "kind": "CustomIntegration",
    "tags": [],
    "_link": "/pipeline/api/custom-integrations/bdbed50f9a071e7558b79f7c3c7e2",
    "_createdBy": "slynch",
    "_updatedBy": "slynch",
    "_updateTimeInMicros": 1560733314916000
}